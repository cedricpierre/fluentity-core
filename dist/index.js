var R=s=>{throw TypeError(s)};var M=(s,t,e)=>t.has(s)||R("Cannot "+e);var h=(s,t,e)=>(M(s,t,"read from private field"),e?e.call(s):t.get(s)),m=(s,t,e)=>t.has(s)?R("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),T=(s,t,e,r)=>(M(s,t,"write to private field"),r?r.call(s,e):t.set(s,e),e);var c,g,o=class{static configure(t){this.options={...this.options,...t}}static deleteCache(t){h(this,c).delete(t)}static clearCache(){h(this,c).clear()}static get cache(){return h(this,c)}static getCache(t){return h(this,c).get(t)}static get url(){return h(this,g)}static async call(t,e){try{if(T(this,g,t),!this.options.baseUrl)throw new Error("baseUrl is required");if(this.options.cacheOptions?.enabled){let a=h(this,c).get(t);if(a){if(Date.now()-a.timestamp<(this.options.cacheOptions.ttl||0))return a.data;h(this,c).delete(t)}}let r={...e,...this.options?.options},i={url:`${this.options.baseUrl}/${t}`,options:r};this.options.requestInterceptor&&Object.assign(i,this.options.requestInterceptor.call(this,i));let n=await this.options.requestHandler.call(this,i);return this.options.responseInterceptor&&(n=this.options.responseInterceptor.call(this,n)),this.options.cacheOptions?.enabled&&h(this,c).set(t,{data:n,timestamp:Date.now()}),n}catch(r){throw this.options.errorInterceptor&&r instanceof Error&&this.options.errorInterceptor(r),r}}};c=new WeakMap,g=new WeakMap,m(o,c,new Map),m(o,g,""),o.options={baseUrl:"",options:{headers:{"Content-Type":"application/json"}},requestInterceptor:void 0,responseInterceptor:void 0,errorInterceptor:void 0,requestHandler:w,cacheOptions:{enabled:!1,ttl:5*60*1e3}};async function w(s){let t={...s.options};t.headers?.["Content-Type"]==="application/json"&&t.body&&(t.body=JSON.stringify(t.body));try{return(await fetch(s.url,t)).json()}catch(e){throw new Error(`HTTP error: ${e}`)}}var d={GET:"GET",POST:"POST",PUT:"PUT",PATCH:"PATCH",DELETE:"DELETE",HEAD:"HEAD",OPTIONS:"OPTIONS"};var b=class{constructor(){this._path="";this._query={};this._includes=[];this._sort=[]}path(t){return this._path=t,this}id(t){return this._id=t,this}where(t){return this.filter(t)}filter(t){return this._query={...this._query,...t},this}include(t){return this._includes.push(...Array.isArray(t)?t:[t]),this}orderBy(t,e="asc"){return this._sort.push(`${e==="desc"?"-":""}${t}`),this}page(t){return this._page=t,this}perPage(t){return this._perPage=t,this}offset(t){return this._offset=t,this}limit(t){return this._limit=t,this}reset(){return this._query={},this._includes=[],this._sort=[],this._limit=void 0,this._offset=void 0,this._page=void 0,this._perPage=void 0,this._id=void 0,this._path="",this}toUrl(){let t=this._path;return this._id&&(t+=`/${String(this._id)}`),this.toQueryString()&&(t+=`?${this.toQueryString()}`),t}toQueryString(){let t={...this._query};return this._includes.length&&(t.include=this._includes.join(",")),this._sort.length&&(t.sort=this._sort.join(",")),this._limit!==void 0&&(t.limit=this._limit),this._offset!==void 0&&(t.offset=this._offset),this._page!==void 0&&(t.page=this._page),this._perPage!==void 0&&(t.per_page=this._perPage),Object.entries(t).map(([e,r])=>`${e}=${r}`).join("&")}};var p=class{constructor(t,e,r){this.path="";this.queryBuilder=e??new b,this.relatedModel=t(),this.path=r??this.relatedModel.resource,this.relatedModel.path=this.path,this.relatedModel.scopes&&Object.entries(this.relatedModel.scopes).forEach(([i,n])=>{this[i]=(...a)=>n(this,...a)})}id(t){let e=new this.relatedModel({id:t});return e.path=`${this.path}/${t}`,e}async find(t){this.queryBuilder.id(t);let e=await o.call(this.buildUrl()),r=new this.relatedModel(e);return r.path=`${this.path}/${t}`,r}where(t){return this.queryBuilder.where(t),this}filter(t){return this.queryBuilder.filter(t),this}include(t){return this.queryBuilder.include(t),this}orderBy(t,e="asc"){return this.queryBuilder.orderBy(t,e),this}limit(t){return this.queryBuilder.limit(t),this}offset(t){return this.queryBuilder.offset(t),this}buildUrl(){let t=this.queryBuilder.path(this.path).toUrl();return this.queryBuilder.reset(),decodeURIComponent(`${t}`)}};var y=class extends p{async get(){let t=await o.call(`${this.path}/${this.relatedModel.id}`,{method:d.GET});return new this.relatedModel(t)}async update(t){let e=await o.call(`${this.path}/${this.relatedModel.id}`,{method:d.PATCH,body:t});return new this.relatedModel(e)}async delete(){await o.call(`${this.path}/${this.relatedModel.id}`,{method:d.DELETE})}};var u=class extends p{async all(){return(await o.call(this.buildUrl()))?.map(e=>new this.relatedModel(e))}async create(t){let e=await o.call(this.path,{method:d.POST,body:t});return new this.relatedModel(e)}async delete(t){await o.call(`${this.path}/${t}`,{method:d.DELETE})}async update(t,e){let r=await o.call(`${this.path}/${t}`,{method:d.PUT,body:e});return new this.relatedModel(r)}async paginate(t=1,e=10){return this.queryBuilder.page(t).perPage(e).offset((t-1)*e).limit(e),(await o.call(this.buildUrl()))?.map(i=>new this.relatedModel(i))}};var f,l=class l{constructor(t){m(this,f);return t&&Object.assign(this,t),T(this,f,this.constructor.path??this.constructor.resource),this.id&&(this.path+=`/${this.id}`),this}get path(){return h(this,f)}set path(t){T(this,f,t)}static getRelationBuilder(t,e){let r=`${t.name}_${e.name}`;if(!l._relationCache.has(r)){let n=t.resource;l._relationCache.set(r,new e(()=>t,void 0,n))}return l._relationCache.get(r)}static id(t){return new this({id:t})}static query(){return l.getRelationBuilder(this,u)}static where(t){return l.getRelationBuilder(this,u).where(t)}static filter(t){return l.getRelationBuilder(this,u).filter(t)}static include(t){return l.getRelationBuilder(this,u).include(t)}static async all(){return await l.getRelationBuilder(this,u).all()}static async find(t){return await l.getRelationBuilder(this,y).find(t)}static async create(t){return await l.getRelationBuilder(this,u).create(t)}static async update(t,e){return await l.getRelationBuilder(this,u).update(t,e)}static async delete(t){return l.getRelationBuilder(this,u).delete(t)}async get(){let t=this.constructor.path,e=await o.call(`${t}/${this.id}`,{method:d.GET});return Object.assign(this,e),this}async save(){if(this.id)return this.update();let t=this.constructor.path,e=await o.call(t,{method:d.POST,body:{...this}});return Object.assign(this,e),this}async update(t){let e=this.constructor.path;t&&Object.assign(this,t);let r=await o.call(`${e}/${this.id}`,{method:d.PATCH,body:{...this}});return Object.assign(this,r),this}async delete(){let t=this.constructor.path;await o.call(`${t}/${this.id}`,{method:d.DELETE})}toObject(){let t={};Object.keys(this).forEach(r=>{t[r]=this[r]});let e=Object.getOwnPropertyDescriptors(Object.getPrototypeOf(this));for(let[r,i]of Object.entries(e))if(i.get){let n=this[r];n instanceof l?t[r]=n.toObject():Array.isArray(n)&&n.length>0&&(t[r]=n.filter(a=>a instanceof l).map(a=>a.toObject()))}return t}};f=new WeakMap,l._relationCache=new Map;var B=l;var P=(s,t,e)=>function(r,i){Object.defineProperty(r,i,{get(){let n=(this.path?`${this.path}/`:"")+(e??String(i));return new t(s,void 0,n)},enumerable:!0,configurable:!0})},F=s=>function(t,e){let r=Symbol(String(e));Object.defineProperty(t,e,{get(){this[r]||(this[r]=void 0);let i=this[r];if(!i)return i;let n=s();return n?Array.isArray(i)?i.map(a=>a instanceof n?a:new n(a)):i instanceof n?i:new n(i):i},set(i){let n=s();if(!n){this[r]=i;return}Array.isArray(i)?this[r]=i.map(a=>a instanceof n?a:new n(a)):i instanceof n?this[r]=i:this[r]=new n(i)},enumerable:!0,configurable:!0})},H=(s,t)=>P(s,y,t),O=(s,t)=>P(s,u,t),V=H,W=O;export{V as BelongsTo,W as BelongsToMany,F as Cast,o as Fluentity,O as HasMany,H as HasOne,o as HttpClient,d as Methods,B as Model,p as RelationBuilder,w as fetchRequestHandler};
